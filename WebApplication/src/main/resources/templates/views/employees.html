<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="">

<head>
    <meta charset="UTF-8">
    <title th:text="#{view.employee.title}"></title>

    <link rel="stylesheet" th:href="@{/css/color.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">

    <!-- bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <!-- bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body class="">
<div th:replace="~{fragments/navbar}">Navbar</div>
<div class="">
    <!-- content -->
    <div>
        <!-- alerts -->
        <div  class="row">
            <div th:if="(${(param.edit != null)} or ${(param.create != null)} or ${(param.delete != null)} or ${(param.subordinate != null)})"
                 class="alert alert-success alert-dismissible fade show" role="success">
                <strong th:if="${(param.edit != null)}" th:text="#{view.employee.alert.edit}"></strong>
                <strong th:if="${(param.create != null)}" th:text="#{view.employee.alert.create}"></strong>
                <strong th:if="${(param.subordinate != null)}" th:text="#{view.employee.alert.subordinate}"></strong>
                <strong th:if="${(param.delete != null)}" th:text="#{not-implemented}"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
        <!-- table -->
        <h1 class="text-center mt-5" th:text="#{view.employee.header}"></h1>
        <a type="button" class="btn btn-primary common-border-radius"
           th:href="@{/e/create}" th:text="#{view.employee.create}"></a>
        <div class="row my-container">
            <table class="my-table">
                <thead>
                <tr class="employee-row-header">
                    <th scope="col"></th>
                    <th scope="col" th:text="#{view.employee.table.fname}"></th>
                    <th scope="col" th:text="#{view.employee.table.lname}"></th>
                    <th scope="col" th:text="#{view.employee.table.wrk-abbreviation}"></th>
                    <th scope="col" th:text="#{view.employee.table.wrk-projects}"></th>
                    <th scope="col" th:text="#{view.employee.table.wrk-courses}"></th>
                    <th scope="col" th:text="#{view.employee.table.wrk-functions}"></th>
                    <th scope="col" th:text="#{view.employee.table.certain-time}"></th>
                    <th scope="col" th:text="#{view.employee.table.uncertain-time}"></th>
                    <th scope="col"></th>
                </tr>
                </thead>
                <tbody>
                <th:block th:each="emp, iStat: ${employees}">
                    <!-- Employee-->
                    <tr class="employee-row-value" th:id="${iStat.index}">
                        <td>
                            <a type="button" class="btn collapsible btn-detail" th:href="@{/e/{EMP_ID}/detail(EMP_ID=${emp.getId()})}"></a>
                        </td>
                        <td th:text="${emp.getFirstName()}"></td>
                        <td th:text="${emp.getLastName()}"></td>
                        <td th:text="${emp.getWorkplace().getAbbreviation()}"></td>
                        <td th:text="${emp.getProjectsAllocations().size()}"></td>
                        <td th:text="${emp.getCoursesAllocations().size()}"></td>
                        <td th:text="${emp.getFunctionsAllocations().size()}"></td>
                        <td th:text="${emp.getCertainTime()}"></td>
                        <td th:text="${emp.getUncertainTime()}"></td>
                    </tr>
                    <tr>
                        <td colspan="18">
                            <table class="my-collapse">
                                <thead>
                                <!-- Projects header -->
                                <tr class="project-row-title">
                                    <td th:text="#{view.employee.table.activity.projects}"></td>
                                </tr>
                                <!-- Project labels -->
                                <tr class="project-row-header">
                                    <td></td>
                                    <td class="project-cell" style="width: 250px" th:text="#{view.employee.table.activity.name}"></td>
                                    <td class="project-cell" th:text="#{view.employee.table.project.role}"></td>
                                    <td class="project-cell" th:text="#{view.employee.table.activity.certain}"></td>
                                    <td class="project-cell" th:text="#{month.january}"></td>
                                    <td class="project-cell" th:text="#{month.february}"></td>
                                    <td class="project-cell" th:text="#{month.march}"></td>
                                    <td class="project-cell" th:text="#{month.april}"></td>
                                    <td class="project-cell" th:text="#{month.may}"></td>
                                    <td class="project-cell" th:text="#{month.june}"></td>
                                    <td class="project-cell" th:text="#{month.july}"></td>
                                    <td class="project-cell" th:text="#{month.august}"></td>
                                    <td class="project-cell" th:text="#{month.september}"></td>
                                    <td class="project-cell" th:text="#{month.october}"></td>
                                    <td class="project-cell" th:text="#{month.november}"></td>
                                    <td class="project-cell" th:text="#{month.december}"></td>
                                    <td class="project-cell"></td>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Projects values -->
                                <th:block th:each="all, allStat: ${emp.getProjectsAllocations()}">
                                    <form th:method="POST" th:action="@{'/a/' + ${all.getId() + '/edit?mana'}}" th:object="${all}" novalidate>
                                        <th:block>
                                            <tr class="project-row-value">
                                                <th scope="row" th:text="(${allStat.index } + 1)"></th>
                                                <td class="project-cell" th:text="${all.getProject().getName()}"></td>
                                                <td class="project-cell" th:text="${all.getProject().getName()}"></td>
                                                <td class="project-cell" th:text="${all.getProject().getProbability()}"></td>
                                                <td class="project-cell project-input">
                                                    <label><input class="project-input" th:type="text" th:value="${all.getProject().getProbability()}"/></label>
                                                </td>
                                                <th:block th:each="perMonth : ${all.getProject().getYearAllocation()}">
                                                    <td class="project-cell">
                                                        <label><input class="project-input" th:type="text" th:value="${perMonth}"/></label>
                                                    </td>
                                                </th:block>
                                                <td>
                                                    <button class="btn collapsible btn-edit" th:onclick="'editProject('+${all.getId()}+')'"></button>
                                                </td>
                                            </tr>
                                        </th:block>
                                    </form>
                                </th:block>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="18">
                            <table class="my-collapse">
                                <thead>
                                <!-- Courses header -->
                                <tr class="course-row-title">
                                    <td th:text="#{view.employee.table.activity.courses}"></td>
                                </tr>
                                <!-- Course labels -->
                                <tr class="course-row-header">
                                    <td class="course-cell"></td>
                                    <td class="course-cell" th:text="#{view.employee.table.activity.name}"></td>
                                    <td class="course-cell" th:text="#{view.employee.table.course.students}"></td>
                                    <td class="course-cell" th:text="#{view.employee.table.activity.certain}"></td>
                                    <td class="course-cell" th:text="#{month.january}"></td>
                                    <td class="course-cell" th:text="#{month.february}"></td>
                                    <td class="course-cell" th:text="#{month.march}"></td>
                                    <td class="course-cell" th:text="#{month.april}"></td>
                                    <td class="course-cell" th:text="#{month.may}"></td>
                                    <td class="course-cell" th:text="#{month.june}"></td>
                                    <td class="course-cell" th:text="#{month.july}"></td>
                                    <td class="course-cell" th:text="#{month.august}"></td>
                                    <td class="course-cell" th:text="#{month.september}"></td>
                                    <td class="course-cell" th:text="#{month.october}"></td>
                                    <td class="course-cell" th:text="#{month.november}"></td>
                                    <td class="course-cell" th:text="#{month.december}"></td>
                                    <td class="course-cell"></td>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Courses values -->
                                <th:block th:each="all, allStat: ${emp.getCoursesAllocations()}">
                                    <form th:method="POST" th:action="@{'/a/' + ${all.getId() + '/edit?mana'}}" th:object="${all}" novalidate>
                                        <th:block>
                                            <tr class="course-row-value">
                                                <td></td>
                                                <td th:text="${all.getCourse().getName()}"></td>
                                                <td th:text="${all.getCourse().getName()}"></td>
                                                <td class="course-cell">
                                                    <label><input class="project-input" th:type="text" th:value="${all.getCourse().getProbability()}"/></label>
                                                </td>
                                                <th:block th:each="perMonth : ${all.getCourse().getYearAllocation()}">
                                                    <td class="course-cell">
                                                        <label><input class="project-input" th:type="text" th:value="${perMonth}"/></label>
                                                    </td>
                                                </th:block>
                                            </tr>
                                        </th:block>
                                    </form>
                                </th:block>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="18">
                            <table class="my-collapse">
                                <thead>
                                <!-- Functions header -->
                                <tr class="function-row-title">
                                    <td th:text="#{view.employee.table.activity.functions}"></td>
                                </tr>
                                <!-- Function labels -->
                                <tr class="function-row-header">
                                    <td class="function-cell"></td>
                                    <td class="function-cell" th:text="#{view.employee.table.activity.name}"></td>
                                    <td class="function-cell" th:text="#{view.employee.table.project.role}"></td>
                                    <td class="function-cell" th:text="#{view.employee.table.activity.certain}"></td>
                                    <td class="function-cell" th:text="#{month.january}"></td>
                                    <td class="function-cell" th:text="#{month.february}"></td>
                                    <td class="function-cell" th:text="#{month.march}"></td>
                                    <td class="function-cell" th:text="#{month.april}"></td>
                                    <td class="function-cell" th:text="#{month.may}"></td>
                                    <td class="function-cell" th:text="#{month.june}"></td>
                                    <td class="function-cell" th:text="#{month.july}"></td>
                                    <td class="function-cell" th:text="#{month.august}"></td>
                                    <td class="function-cell" th:text="#{month.september}"></td>
                                    <td class="function-cell" th:text="#{month.october}"></td>
                                    <td class="function-cell" th:text="#{month.november}"></td>
                                    <td class="function-cell" th:text="#{month.december}"></td>
                                    <td class="function-cell"></td>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Functions values -->
                                <th:block th:each="all, allStat: ${emp.getFunctionsAllocations()}">
                                    <form th:method="POST" th:action="@{'/a/' + ${all.getId() + '/edit?mana'}}" th:object="${all}" novalidate>
                                        <th:block>
                                            <tr class="function-row-value" id="allStat">
                                                <td></td>
                                                <td th:text="${all.getFunction().getName()}"></td>
                                                <td th:text="${all.getFunction().getName()}"></td>
                                                <td class="function-cell">
                                                    <label><input class="function-input" th:type="text" th:value="${all.getFunction().getProbability()}"/></label>
                                                </td>
                                                <th:block th:each="perMonth : ${all.getFunction().getYearAllocation()}">
                                                    <td class="function-cell">
                                                        <label><input class="function-input" th:type="text" th:value="${perMonth}"/></label>
                                                    </td>
                                                </th:block>
                                            </tr>
                                        </th:block>
                                    </form>
                                </th:block>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </th:block>
                </tbody>
            </table>
            <div th:replace="~{fragments/footer}">Footer</div>
        </div>
    </div>
</div>

<script>
    let employeeTr = document.querySelectorAll(".employee-row-value");

    Array.from(employeeTr).forEach(function(trArray) {
        let button = document.createElement("button");
        let td = document.createElement("td");
        button.className = "btn collapsible btn-dropdown";
        button.addEventListener("click", function(evt) {
            let collapse = document.getElementsByClassName("my-collapse");
            let i = trArray.id * 3, ii = trArray.id * 3 + 3;
            for (; i < ii; i++) {
                console.log('index: ' + i);
                if (collapse[i].style.display === "none") {
                    collapse[i].style.display = "block";
                } else {
                    collapse[i].style.display = "none";
                }
            }
        });
        td.append(button);
        trArray.append(td);
    });

    let projectTr = document.querySelectorAll("table .project-row-value");

    Array.from(projectTr).forEach(function(trArray) {
        let button = document.createElement("button");
        let td = document.createElement("td");
        button.className = "btn collapsible btn-edit";
        button.setAttribute('th:onclick', 'editProject(\'' + '+ ${all.getId()}+' + '\')');
        // th:onclick="'editProject('+${all.getId()}+')'"
        button.addEventListener("click", function(ev) {
            // this.classList.toggle("active");
            // var content = trArray;
            console.log(ev.target.id);
            // if (content.style.display === "block") {
            //     content.style.display = "none";
            // } else {
            //     content.style.display = "block";
            // }
        });
        td.append(button);
        trArray.append(td);
    });

    function editProject(projectId) {

    }

    let courseTr = document.querySelectorAll(".course-row-value");

    Array.from(courseTr).forEach(function(trArray) {
        let button = document.createElement("button");
        let td = document.createElement("td");
        button.className = "btn collapsible btn-edit";
        button.setAttribute('onclick', 'sayHi()');
        // button.addEventListener("click", function() {
        //     this.classList.toggle("active");
        //     var content = trArray;
        //     console.log(tr.length);
        //     if (content.style.display === "block") {
        //         content.style.display = "none";
        //     } else {
        //         content.style.display = "block";
        //     }
        // });
        td.append(button);
        trArray.append(td);
    });

    let functionTr = document.querySelectorAll(".function-row-value");

    Array.from(functionTr).forEach(function(trArray) {
        let button = document.createElement("button");
        let td = document.createElement("td");
        button.className = "btn collapsible btn-edit";
        button.setAttribute('onclick', 'sayHi()');
        // button.addEventListener("click", function() {
        //     this.classList.toggle("active");
        //     var content = trArray;
        //     console.log(tr.length);
        //     if (content.style.display === "block") {
        //         content.style.display = "none";
        //     } else {
        //         content.style.display = "block";
        //     }
        // });
        td.append(button);
        trArray.append(td);
    });

    function sayHi() {
        console.log('Hi');
    }

    function detailEmployee(employeeId) {
        window.location.replace(window.location.href + '/' + employeeId +  '/detail');
        // console.log(window.location.href + '/' + employeeId +  '/detail');
    }


</script>

</body>
</html>